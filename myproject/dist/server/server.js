!function(t){var n={};function e(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,e),o.l=!0,o.exports}e.m=t,e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:r})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,n){if(1&n&&(t=e(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(e.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var o in t)e.d(r,o,function(n){return t[n]}.bind(null,o));return r},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},e.p="/",e(e.s=2)}([function(t,n){t.exports=require("fs")},function(t,n){t.exports=require("express")},function(t,n,e){var r=e(1),o=e(0),i=r(),u=e(3);i.use(r.json()),i.use("/",r.static("dist/public")),i.use("/api/cart",u),i.get("/api/products",function(t,n){o.readFile("dist/server/db/products.json","utf-8",function(t,e){t?n.sendStatus(404,JSON.stringify({result:0,text:t})):n.send(e)})});var s=process.env.PORT||3e3;i.listen(s,function(){return console.log("Listen on port ".concat(s,"..."))})},function(t,n,e){var r=e(1),o=e(0),i=r.Router(),u=e(4);i.get("/",function(t,n){o.readFile("dist/server/db/userCart.json","utf-8",function(t,e){t?n.sendStatus(404,JSON.stringify({result:0,text:t})):n.send(e)})}),i.post("/",function(t,n){u(t,n,"add","dist/server/db/userCart.json")}),i.put("/:id",function(t,n){u(t,n,"change","dist/server/db/userCart.json")}),i.delete("/:id",function(t,n){u(t,n,"remove","dist/server/db/userCart.json")}),t.exports=i},function(t,n,e){var r=e(5),o=e(0),i={add:r.add,change:r.change,remove:r.remove};t.exports=function(t,n,e,r){o.readFile(r,"utf-8",function(u,s){if(u)n.sendStatus(404,JSON.stringify({result:0,text:u}));else{var c=i[e](JSON.parse(s),t);o.writeFile(r,c,function(t){t?n.sendStatus(404,JSON.stringify({result:0,text:t})):n.send(JSON.stringify({result:1}))})}})}},function(t,n,e){var r=e(6),o=function(t){t.countGoods=t.contents.reduce(function(t,n){return t+n.quantity},0),t.amount=t.contents.reduce(function(t,n){return t+n.price*n.quantity},0)};t.exports={add:function(t,n){return t.contents.push(n.body),o(t),r.log("add",n.body.product_name),JSON.stringify(t,null,4)},change:function(t,n){var e=t.contents.find(function(t){return t.id_product===+n.params.id});return e.quantity+=n.body.quantity,o(t),r.log("increment quantity to ".concat(e.quantity),e.product_name),JSON.stringify(t,null,4)},remove:function(t,n){var e=t.contents.find(function(t){return t.id_product===+n.params.id});if(void 0!==e)if(e.quantity--,0===e.quantity){var i=t.contents.indexOf(e);t.contents.splice(i,1),r.log("delete",e.product_name)}else r.log("decrement quantity to ".concat(e.quantity),e.product_name);return o(t),JSON.stringify(t,null,4)}}},function(t,n,e){var r=e(0),o=e(7),i="dist/server/db/stats.json",u=function(){r.open(i,"wx",function(t,n){if(t){if("EEXIST"===t.code)return;throw t}r.write(n,JSON.stringify([]),0,"utf-8",function(t){if(t)throw t}),r.close(n,function(t){if(t)throw t})})};t.exports.log=function(t,n){try{u();var e=o().format("MMMM Do YYYY, h:mm:ss a");r.readFile(i,"utf-8",function(o,u){if(o)throw o;var s=JSON.parse(u);s.push({dateTime:e,action:t,productName:n}),r.writeFile(i,JSON.stringify(s,null,4),function(t){if(t)throw t})})}catch(t){console.error(t)}}},function(t,n){t.exports=require("moment")}]);